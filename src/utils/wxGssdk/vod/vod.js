"use strict";function dealDeviationsTime(t,e,a){return t-e>=0&&t-e<a||e-t>0&&e-t<a}function dealAnnoData(t){if((t=t.data)&&t.module&&tool.isArray(t.module.command)){for(var e=t.module.command,a={},o=0;o<e.length;o++)a[e[o].timestamp]?a[e[o].timestamp].push(e[o]):(a[e[o].timestamp]=new Array,a[e[o].timestamp].push(e[o]));for(var n in a){var s=1e3*parseFloat(n),r=1e3*parseFloat(n)+1e3;tasks.addTask(TASK_TYPE.ANNOTATION,{cmd:"anno",annoArray:a[n]},s,r,!0,"between");var i={};i.timestamp=s,i.annoArray=a[n];for(var l=0;l<pptRecord.pageRecordInfo.length;l++)if(s>pptRecord.pageRecordInfo[l].starttimestamp&&s<pptRecord.pageRecordInfo[l].stoptimestamp){pptRecord.pageRecordInfo[l].annodata.push(i);break}}}else if(t&&t.module&&"[object Object]"==Object.prototype.toString.call(t.module.command)){var e=t.module.command,a={};a[e.timestamp]=new Array,a[e.timestamp].push(e);for(var n in a){var s=1e3*parseFloat(n),r=1e3*parseFloat(n)+1e3;tasks.addTask(TASK_TYPE.ANNOTATION,{cmd:"anno",annoArray:a[n]},s,r,!0,"between");var i={};i.timestamp=s,i.annoArray=a[n];for(var l=0;l<pptRecord.pageRecordInfo.length;l++)if(s>pptRecord.pageRecordInfo[l].starttimestamp&&s<pptRecord.pageRecordInfo[l].stoptimestamp){pptRecord.pageRecordInfo[l].annodata.push(i);break}}}}function pptGetRecord(t){if(t.conf.jsanno&&null!=t.conf.jsanno){pptRecord.record_max_time=1e3*parseFloat(t.conf.duration),pptRecord.record_MainAnno=t.conf.jsanno,pptRecord.hasAnno=!0;for(var e={},a=0;a<t.conf.module.length;a++)"multirecord"==t.conf.module[a].name&&(e=t.conf.module[a].multirecord);if(tool.isArray(e)){for(var o=0,n=[],s=0;s<e.length;s++)(e[s].jsanno&&null!=e[s].jsanno||e[s].anno&&null!=e[s].anno)&&(!e[s].jsanno&&e[s].anno&&(e[s].jsanno=e[s].anno.replace("xml","js")),n[e[s].jsanno]?n[e[s].jsanno]&&(pptRecord.record_jsanno[o]={jsanno:e[s].jsanno,starttimestamp:1e3*parseFloat(e[s].starttimestamp),stoptimestamp:1e3*parseFloat(e[s].stoptimestamp),duration:1e3*parseFloat(e[s].duration)},o++):(n[e[s].jsanno]=e[s].jsanno,pptRecord.record_jsanno[o]={jsanno:e[s].jsanno,starttimestamp:1e3*parseFloat(e[s].starttimestamp),stoptimestamp:1e3*parseFloat(e[s].stoptimestamp),duration:1e3*parseFloat(e[s].duration)},o++));pptRecord.record_jsanno[0]?tool.ajax({type:"GET",url:mediaInfo.visitUrl+pptRecord.record_jsanno[0].jsanno,dataType:"json",success:function(t){pptRecord.record_jsanno_old[pptRecord.record_jsanno[0].jsanno]=1,pptRecord.is_pptRecord=1,dealAnnoData(t)},error:function(t){pptRecord.record_jsanno=[],pptRecord.recordGetMainAnno()}}):pptRecord.recordGetMainAnno()}else if(e.jsanno){var r=e.jsanno;pptRecord.record_jsanno[0]={jsanno:r,starttimestamp:1e3*parseFloat(e.starttimestamp),stoptimestamp:1e3*parseFloat(e.stoptimestamp),duration:1e3*parseFloat(e.duration)},tool.ajax({type:"GET",url:mediaInfo.visitUrl+r,dataType:"json",success:function(t){pptRecord.record_jsanno_old[r]=1,pptRecord.is_pptRecord=1,dealAnnoData(t)},error:function(t){pptRecord.record_jsanno=[],pptRecord.recordGetMainAnno()}})}else pptRecord.recordGetMainAnno()}}function chatTimeSort(t,e){return t.timestamp-e.timestamp}function dealChatMsg(t){if(tool.isArray(t)){t.length>0&&(synChat.currentTime=t[t.length-1].timestamp);for(var e=0;e<t.length;e++){var a,o,n={};n.list=new Array,a=1e3*parseFloat(t[e].timestamp),o=a+1e3;var s=t[e].ems;if(s){if(tool.isArray(s))for(var r=0;r<s.length;r++){var i={};i.sender=s[r].sender,i.content=s[r].text,i.submitTime=synChat.startTime+a,i.senderId=s[r].senderId,i.senderRole=analysisRole(s[r].senderRole);var l={timestamp:a,data:i};synChat.chathisData.push(l),n.list.push(i)}else{var i={};i.sender=s.sender,i.content=s.text,i.submitTime=synChat.startTime+a,i.senderId=s.senderId,i.senderRole=analysisRole(s.senderRole);var l={timestamp:a,data:i};synChat.chathisData.push(l),n.list.push(i)}addchatTask(n,a,o)}}}else if(t.timestamp){synChat.currentTime=t.timestamp;var a,o,n={};n.list=new Array,a=1e3*parseFloat(t.timestamp),o=a+1e3;var s=t.ems;if(s){if(tool.isArray(s))for(var r=0;r<s.length;r++){var i={};i.sender=s[r].sender,i.content=s[r].text,i.submitTime=synChat.startTime+a,i.senderId=s[r].senderId,i.senderRole=analysisRole(s[r].senderRole);var l={timestamp:a,data:i};synChat.chathisData.push(l),n.list.push(i)}else{var i={};i.sender=s.sender,i.content=s.text,i.submitTime=synChat.startTime+a,i.senderId=s.senderId,i.senderRole=analysisRole(s.senderRole);var l={timestamp:a,data:i};synChat.chathisData.push(l),n.list.push(i)}addchatTask(n,a,o)}}synChat.chathisData.sort(chatTimeSort);var t={};tool.isBlank(recordInfo.jsContent)||(t.supportChatSync=!0),channel.send("onDataReady",t)}function addchatTask(t,e,a){if(synChat.chatSync)tasks.addTask(TASK_TYPE.CHAT,t,e,a,!0,"between");else{var o={starttime:e,stoptime:a,data:t};synChat.chatData.push(o)}}function analysisRole(t){var e="";return""!=t&&(t-=0,t%2==1&&(e+="1,",t-=1),t%4==2&&(e+="2,",t-=2),t%8==4&&(e+="4,",t-=4),t%16==8&&(e+="8,",t-=8),t-16==0&&(e+="16,"),e.length>0&&(e=e.substring(0,e.length-1))),e}function initEvent(){for(var t=["seek","pause","play","leaveMessage","submitVote","playheadTime","submitMute","submitVolume","submitStop","submitQAList","submitChatHistory","submitLeaveMessageList","showControlBar","submitAnswerSheet","setupChatSync","submitChatSegment","checkExit","uploadLogFile"],e=function e(a,o){if(!eventConfig.widgetReady)return channel.send("onAPIError",{api:a.type,param:a.data,explain:"Core-widget not ready, please wait a moment!",type:"9"}),void o();if(onBindEventHandler(a),"submitStop"==a.type)for(var n=0;n<t.length;n++)channel.unbind(t[n],e)},a=0;a<t.length;a++)"uploadLogFile"===t[a]?channel.bind("uploadLogFile",function(t){submitDealFuns.uploadLogFile(t.data)}):channel.bind(t[a],e)}function initScheduler(){tasks=new task,tasks.addTaskFunction(TASK_TYPE.PPT,function(t){sendEvent("onDocChange",{doc:t.docName,title:t.title,width:t.width,height:t.height,hls:t.hls}),sendEvent("onDocUrl",t)},null),tasks.addTaskFunction(TASK_TYPE.ANNOTATION,function(t){sendEvent("onAnno",t)},null),tasks.addTaskFunction(TASK_TYPE.CHAT,function(t){synChat.chatSync&&sendEvent("onChat",t)},null),tasks.addTaskFunction(TASK_TYPE.LOTTERY,function(t){sendEvent("onLottery",t)},null),tasks.addTaskFunction(TASK_TYPE.VOTE,function(t){sendEvent("onVote",t)},null)}function getXmlData(){logger.log("[getXmlData]","info",vodInfo.xmlUrl),tool.isBlank(vodInfo.xmlUrl)||tool.ajax({url:vodInfo.xmlUrl,dateType:"xml",success:function(t){logger.log("[getXmlData]","info",t),prepareData(t)},error:function(){logger.log("[getXmlData]","error",vodInfo.xmlUrl)}})}function prepareData(t){t=tool.parseXml(t.data);var e=t.documentElement;if("5"==tool.getXmlNodeAttr(e,"ver")?(recordInfo.hls=tool.getXmlNodeAttr(e,"mobilenormal"),recordInfo.highHls=tool.getXmlNodeAttr(e,"mobilehigh")):recordInfo.hls=tool.getXmlNodeAttr(e,"hls"),recordInfo.hlsAudioOnly=tool.getXmlNodeAttr(e,"hlsaudioonly"),recordInfo.duration=tool.getXmlNodeAttr(e,"duration"),recordInfo.liveTextFile=tool.getXmlNodeAttr(e,"livetextfile"),recordInfo.jsContent=tool.getXmlNodeAttr(e,"js"),recordInfo.playing=!0,tool.isBlank(recordInfo.hls))recordInfo.playing=!1,sendEvent("onStatus",{type:4,explain:"not support mobile"});else{for(var a=e.getElementsByTagName("module"),o=0;o<a.length;o++){var n=tool.getXmlNodeAttr(a[o],"name");if("document"==n)for(var s=a[o].childNodes,r=0;r<s.length;r++){var i=tool.getXmlNodeAttr(s[r],"name"),l=s[r].childNodes;if(l)for(var d=0;d<l.length;d++){var c=l[d];if("page"==c.nodeName){var m={};m.docName=i,m.title=tool.getXmlNodeAttr(c,"title"),m.hls=tool.getXmlNodeAttr(c,"hls"),m.startTime=tool.getXmlNodeAttr(c,"starttimestamp"),m.endTime=tool.getXmlNodeAttr(c,"stoptimestamp"),m.content=tool.getXmlNodeAttr(c,"content"),m.height=tool.getXmlNodeAttr(c,"height"),m.width=tool.getXmlNodeAttr(c,"width"),recordInfo.docArray.push(m)}}}else if("vote"==n||"survey"==n){for(var p=a[o].childNodes,r=0;r<p.length;r++)if("command"==p[r].nodeName){var u=p[r],h=tool.getXmlNodeAttr(u,"type");if("publish_card"==h)continue;var f={};f.id=tool.getXmlNodeAttr(u,"id"),f.startTime=tool.getXmlNodeAttr(u,"timestamp"),f.skip=tool.getXmlNodeAttr(u,"skip");var y=u.childNodes;f.questions=new Array;for(var d=0;d<y.length;d++){var v=y[d];if("subject"==v.nodeName)f.subject=tool.trim(v.textContent);else if("question"==v.nodeName){var g={};g.id=tool.getXmlNodeAttr(v,"id"),g.type=tool.getXmlNodeAttr(v,"type"),g.answer=tool.getXmlNodeAttr(v,"answer"),g.text="";var I=v.childNodes;g.items=new Array;for(var T=0;T<I.length;T++){var A=I[T];if("subject"==A.nodeName)g.subject=tool.trim(A.textContent);else if("item"==A.nodeName){var C={};C.id=tool.getXmlNodeAttr(A,"id"),C.option=tool.trim(A.textContent),C.correct=tool.getXmlNodeAttr(A,"correct"),C.selected=tool.getXmlNodeAttr(A,"selected"),g.items.push(C)}}f.questions.push(g)}}recordInfo.voteSurveyList.push(f)}}else if("lottery"==n)for(var k=a[o].childNodes,r=0;r<k.length;r++){var x=k[r],f={};f.cmd=tool.getXmlNodeAttr(x,"cmd"),f.timestamp=tool.getXmlNodeAttr(x,"timestamp"),f.info=tool.getXmlNodeAttr(x,"info"),tool.isBlank(f.cmd)||recordInfo.lotteryArray.push(f)}else if("layout"==n)for(var b=a[o].childNodes,r=0;r<b.length;r++){var j=b[r],f={};f.type=tool.getXmlNodeAttr(j,"type"),f.timestamp=tool.getXmlNodeAttr(j,"timestamp"),tool.isBlank(f.type)||recordInfo.layoutArray.push(f)}}eventConfig.widgetReady=!0,getSessionIdByALb()}}function getSessionIdByALb(){var t="?siteid="+vodInfo.siteId+"&userid="+vodInfo.userId+"&confid="+vodInfo.confId+"&username="+encodeURIComponent(vodInfo.userName)+"&onlylogin="+vodInfo.onlyLogin;if(tool.isBlank(vodInfo.hostId)||(t+="&hostid="+vodInfo.hostId),t+="&type=0&r="+(new Date).getTime(),tool.isBlank(vodInfo.alb))getSessionIdByBackALb();else{serverParam.currentAlb=vodInfo.alb;var e=vodInfo.protocolPrex+wxxApi+vodInfo.alb+"/license"+t;tool.ajax({url:e,success:function(t){t=t.data+"",tool.isBlank(t)?getSessionIdByBackALb():dealLicense(t)},error:function(t){getSessionIdByBackALb()}})}}function getSessionIdByBackALb(){if(!tool.isBlank(vodInfo.backAlb)){serverParam.currentAlb=vodInfo.backAlb;var t="?siteid="+vodInfo.siteId+"&userid="+vodInfo.userId+"&confid="+vodInfo.confId+"&username="+encodeURIComponent(vodInfo.userName)+"&onlylogin="+vodInfo.onlyLogin;tool.isBlank(vodInfo.hostId)||(t+="&hostid="+vodInfo.hostId),t+="&type=0&r="+(new Date).getTime();var e=vodInfo.protocolPrex+wxxApi+vodInfo.backAlb+"/license"+t;tool.ajax({url:e,success:function(t){t=t.data+"",tool.isBlank(t)?getSessionIdByBackALb():dealLicense(t)},error:function(){logger.log("[getSessionIdByBackALb]error"+e)}})}}function dealLicense(t){var e=t.split(","),a=e[0];"-1"==a?sendEvent("onStatus",{type:6,explain:"The people is logining."}):"0"==a?sendEvent("onStatus",{type:1,explain:"There are not enough license."}):void 0==a||0==a.length?sendEvent("onStatus",{type:7,explain:"Request for the service cannot be fulfilled and you cannot join in."}):(serverParam.sessionId=a,serverParam.startTime=(new Date).getTime(),initRecord())}function keepAlive(){var t=Math.round((new Date).getTime()-serverParam.startTime),e=1e3*Math.round(serverParam.watchMaxDuration),a=1e3*recordInfo.duration,o=Math.round(1e3*app.globalData.currentTime),n="tid="+vodInfo.tid+",t="+t+",d="+e+",v="+a+",sc="+vodInfo.sc+",pos="+o,s="?siteid="+vodInfo.siteId+"&userid="+vodInfo.userId+"&confid="+vodInfo.confId+"&onlylogin="+vodInfo.onlyLogin+"&type=1&sessionid="+serverParam.sessionId+"&needlicense=1&other="+escape(n)+"&username="+encodeURIComponent(vodInfo.userName)+"&r="+(new Date).getTime(),r=vodInfo.protocolPrex+wxxApi+serverParam.currentAlb+"/license"+s;tool.ajax({url:r})}function initRecord(){tool.isBlank(vodInfo.xmlUrl)||(mediaInfo.visitUrl=vodInfo.xmlUrl.substring(0,vodInfo.xmlUrl.lastIndexOf("/")+1),mediaInfo.videoUrl=mediaInfo.visitUrl+recordInfo.hls,mediaInfo.audioUrl=mediaInfo.visitUrl+recordInfo.hlsAudioOnly),sendEvent("onVideoUrl",{mediaUrl:mediaInfo.videoUrl}),sendEvent("onAudioUrl",{mediaUrl:mediaInfo.audioUrl}),eventConfig.canPlay=!0,serverParam.keepTimeId=setInterval(function(){keepAlive()},serverParam.keepInterval),initScheduler(),initTaskData(),getRemoteData()}function initTaskData(){if(!tool.isEmpty(recordInfo.docArray)&&recordInfo.docArray.length>0){var t={};t.list=new Array;for(var e=0;e<recordInfo.docArray.length;e++){var a=recordInfo.docArray[e];a.hlsid=a.hls.replace("hls/","").replace(".png",""),a.hls=mediaInfo.visitUrl+a.hls,tasks.addTask(TASK_TYPE.PPT,a,1e3*a.startTime,1e3*a.endTime,!0,"between");var o={doc:a.docName,title:a.title,starttimestamp:1e3*a.startTime,stoptimestamp:1e3*a.endTime};t.list.push(o);var n={hlsid:a.hlsid,starttimestamp:1e3*a.startTime,stoptimestamp:1e3*a.endTime,annodata:[]};pptRecord.pageRecordInfo.push(n)}sendEvent("onChapter",t)}if(tool.isBlank(recordInfo.duration)||sendEvent("onFileDuration",{duration:1e3*recordInfo.duration}),!tool.isEmpty(recordInfo.voteSurveyList)&&recordInfo.voteSurveyList.length>0)for(var e=0;e<recordInfo.voteSurveyList.length;e++){var s=recordInfo.voteSurveyList[e],r=1e3*s.startTime;s.startTime=void 0,tasks.addTask(TASK_TYPE.VOTE,s,r,null)}if(!tool.isEmpty(recordInfo.lotteryArray)&&recordInfo.lotteryArray.length>0)for(var e=0;e<recordInfo.lotteryArray.length;e++){var i=recordInfo.lotteryArray[e],l={};"1"==i.cmd?l.action="start":"2"==i.cmd?(l.action="stop",l.user=i.info):l.action="abort",tasks.addTask(TASK_TYPE.LOTTERY,l,1e3*i.timestamp,null)}if(!tool.isEmpty(recordInfo.layoutArray)&&recordInfo.layoutArray.length>0)for(var e=0;e<recordInfo.layoutArray.length;e++){var d=recordInfo.layoutArray[e];tasks.addTask(TASK_TYPE.LAYOUT,{focus:d.type},1e3*d.timestamp,null)}}function getRemoteData(){if(!tool.isBlank(recordInfo.jsContent))try{var t=mediaInfo.visitUrl+recordInfo.jsContent;tool.ajax({type:"GET",url:t,dataType:"json",success:function(t){t=t.data,pptGetRecord(t),synChat.chatGetSyn(t)},error:function(t){}})}catch(t){}if(!tool.isBlank(recordInfo.liveTextFile))try{var e=mediaInfo.visitUrl+recordInfo.liveTextFile;tool.ajax({type:"GET",url:e,success:function(t){t=tool.parseXml(t.data);for(var e=t.documentElement,a=e.getElementsByTagName("LiveTextItem"),o=new Array,n=0;n<a.length;n++){var s={},r=a[n];s.time=tool.getXmlNodeAttr(r,"timestamp"),s.lang=tool.getXmlNodeAttr(r,"lang"),s.content=tool.trim(r.textContent),o.push(s)}o.length>0&&sendEvent("onTextWebcast",{list:o})},error:function(t){}})}catch(t){}}function checkVote(t){if(tool.isEmpty(t)||tool.isEmpty(t.id))return{result:!1,type:2,explain:"Submission of data is empty."};if(tool.isEmpty(t.questions)||t.questions.length<=0)return{result:!1,type:2,explain:"The questions is empty."};if(tool.isEmpty(t.skip))return{result:!1,type:2,explain:"The skip is empty."};if("true"!=t.skip&&"false"!=t.skip)return{result:!1,type:1,explain:"The value of skip is error."};for(var e=0;e<t.questions.length;e++){var a=t.questions[e];if(tool.isEmpty(a.id))return{result:!1,type:2,explain:"The id of question is empty."};if("text"!=a.type&&"multi"!=a.type&&"single"!=a.type)return{result:!1,type:2,explain:"The type of question is empty."};if("text"!=a.type){if(tool.isEmpty(a.answer)&&"true"!=t.skip)return{result:!1,type:2,explain:"The answer of question is empty."}}else if(tool.isEmpty(a.text)&&"true"!=t.skip)return{result:!1,type:2,explain:"The text of question is empty."}}return{result:!0}}function sendVoteSurvey(t){for(var e=tool.createXml({nodeName:"voteSubmit",attrArray:[{name:"tid",value:vodInfo.tid},{name:"siteid",value:vodInfo.siteId},{name:"userid",value:vodInfo.userId},{name:"username",value:vodInfo.userName},{name:"confid",value:vodInfo.confId},{name:"live",value:"false"}]},"UTF-8"),a=tool.createNode({nodeName:"command",attrArray:[{name:"id",value:t.id}]}),o=t.questions,n=0;n<o.length;n++){var s=o[n],r=tool.createNode({nodeName:"question",attrArray:[{name:"id",value:s.id}]});if("text"==s.type){var i;if(""!=tool.trim(s.text)){var i=tool.createNode({nodeName:"item",value:s.text,attrArray:[{name:"idx",value:0}]});r=tool.addNode(r,i)}}else if(""!=tool.trim(s.answer))for(var l=s.answer.split(","),d=0;d<l.length;d++){var c=l[d]-1,i=tool.createNode({nodeName:"item",attrArray:[{name:"idx",value:c}]});r=tool.addNode(r,i)}a=tool.addNode(a,r)}e=tool.addNode(e,a),logger.log("[sendVoteSurvey]:","info",e),tool.ajax({type:"POST",url:vodInfo.xmlApi,data:e})}var app=getApp(),GSSDK=require("./gssdk.js"),GS=GSSDK.GS,tool=GSSDK.tool,Parser=GSSDK.DOMParser,logger=new GSSDK.tool.logger,logMangement=new GSSDK.tool.logMangement,GS_MEDIA={},tasks,scType="",channel=null,wgid,xmlUrl="",protocolPrex="http://",onlyLogin="0",alb="",backAlb="",wxxApi="",vodInfo={containerId:"",xmlUrl:"",protocolPrex:"http://",sslSupport:!1,siteId:0,userId:0,userName:"",confId:"",hostId:0,tid:"",sc:"sc=0",onlyLogin:"0",alb:"",backAlb:"",xmlApi:"",albProxy:"",video:!0},recordInfo={hls:"",highHls:"",hlsAudioOnly:"",duration:"",liveTextFile:"",jsContent:"",playing:!1,voteSurveyList:new Array,lotteryArray:new Array,layoutArray:new Array,docArray:new Array},serverParam={sessionId:"",currentAlb:"",startTime:0,lastTime:0,watchMaxDuration:0,keepTimeId:0,keepInterval:1e4},TASK_TYPE={PPT:"gensee_task_ppt",VOTE:"gensee_task_vote",LOTTERY:"gensee_task_lottery",LAYOUT:"gensee_task_layout",CHAT:"gensee_task_chat",ANNOTATION:"gensee_task_annotation"},mediaInfo={media:null,visitUrl:"",videoUrl:"",audioUrl:"",lowVideoUrl:""},eventConfig={firstPlay:!0,firstCanPlay:!0,canPlay:!1,seeking:!1},synChat={startTime:"",duration:"",chatMainFile:"",chatList:[],requestedData:{},lastTime:0,chathisData:[],chatData:[],currentTime:0,xmlChat:!1,sliceStartTime:0,sliceEndTime:0,chatSync:!1,allHisFirst:!0,allLastSeekTime:0,playTime:0},pptRecord={is_pptRecord:0,record_max_time:0,record_jsanno:[],record_jsanno_old:{},record_MainAnno:"",hasAnno:!1,pageRecordInfo:[]},playInfo={videoInfo:null,userInfo:null,logFileInfo:{clientApi:"",diagnoseUploadUrl:""}},task=function(t){this.taskArray=new Array,this.taskFunction=new Array,this.defaultOpt={interval:500,deviations:550,status:!1},this.timeOutObj=null,this.dealTask=!1,this.i=0;var e=this;this.timeOut=function(){e.dealTask=!0;var t=e.taskArray,a=e.taskFunction;if(t.length>0){var o=1e3*app.globalData.currentTime;if(o>=0)for(var n=0;n<t.length;n++){var s=t[n];if("usual"==s.deal)if(tool.isEmpty(s.startTime)){for(var r=s.type,i=0;i<a.length;i++){var l=a[i];if(l.type==r){l.startFun.call(this,s.data);break}}t.splice(n,1),n--}else{if(dealDeviationsTime(o,s.startTime,e.defaultOpt.deviations)){if(tool.isEmpty(s.startTimeDeal)||!s.startTimeDeal){for(var r=s.type,i=0;i<a.length;i++){var l=a[i];if(l.type==r){s.startTimeDeal=!0,l.startFun.call(this,s.data);break}}s.forever||(t.splice(n,1),n--)}}else s.startTimeDeal=!1;if(!tool.isEmpty(s.endTime))if(dealDeviationsTime(o,s.endTime,e.defaultOpt.deviations)){var r=s.type;if(tool.isEmpty(s.endTimeDeal)||!s.endTimeDeal)for(var i=0;i<a.length;i++){var l=a[i];if(l.type==r){s.endTimeDeal=!0,l.startFun.call(this,s.data);break}}}else s.endTimeDeal=!1}else if("between"==s.deal)if(o>=s.startTime&&o<=s.endTime||o>=s.startTime&&tool.isEmpty(s.endTime)){if(!s.deal_all){for(var r=s.type,i=0;i<a.length;i++){var l=a[i];if(l.type==r){s.deal_all=!0,l.startFun.call(this,s.data);break}}s.forever||(t.splice(n,1),n--)}}else s.deal_all=!1;else{var d=s.fun.call(this,s.data);d&&(t.splice(n,1),n--)}}}e.dealTask=!1}};task.prototype.switchMedia=function(t){this.media=media},task.prototype.setInterval=function(t){var e=this;return!this.dealTask&&(this.defaultOpt.interval=t,this.defaultOpt.status&&(clearInterval(this.timeOutObj),this.timeOutObj=setInterval(function(){e.timeOut()},this.defaultOpt.interval)),!0)},task.prototype.start=function(){var t=this;this.defaultOpt.status||(this.timeOutObj=setInterval(function(){t.timeOut()},this.defaultOpt.interval),this.defaultOpt.status=!0)},task.prototype.stop=function(){return!this.dealTask&&(clearInterval(this.timeOutObj),this.defaultOpt.status=!1,this.timeOutObj=null,!0)},task.prototype.addTaskFunction=function(t,e,a){var o=this.taskFunction;if(tool.isEmpty(t))return!1;if(!tool.isFunction(e))return!1;var n={type:t,startFun:e};return tool.isFunction(a)?n.endFun=a:n.endFun=function(){},o.push(n),!0},task.prototype.clear=function(){this.taskArray=new Array,this.taskFunction=new Array,this.defaultOpt={interval:500,deviations:550,status:!1},this.dealTask=!1,this.i=0},task.prototype.addTask=function(t,e,a,o,n,s){var r=this.taskArray;if(tool.isEmpty(t))return!1;tool.isEmpty(n)&&(n=!0),tool.isEmpty(s)&&(s="usual");var i={type:t,data:e,startTime:a,endTime:o,forever:n,deal:s,deal_all:!1};return r.push(i),!0};var chatAndMsg={chatMore:!0,qaMore:!0,chatPage:1,qaPage:1,chatDeal:function(t){var e=this;if(this.chatMore){var a='<?xml version="1.0" encoding="utf-8"?><chatHistory siteid="'+vodInfo.siteId+'" userid="'+vodInfo.userId+'" confid="'+vodInfo.confId+'" live="false" page="'+this.chatPage+'"/>';tool.ajax({url:vodInfo.xmlApi,data:a,type:"POST",success:function(o){var o=tool.formatXml(o.data),n={};if(tool.isEmpty(o))logger.log("[chatDeal] xml isempty","info",a);else{var s=new Array,r=o.documentElement,i=r.getElementsByTagName("chatlist");n.more=!1;for(var l=0;l<i.length;l++){n.more=tool.getXmlNodeAttr(i[l],"more"),n.page=tool.getXmlNodeAttr(i[l],"page");for(var d=i[l].getElementsByTagName("chat"),c=0;c<d.length;c++){var m={};m.content=tool.getNodeValue(d[c]),m.submitTime=tool.getXmlNodeAttr(d[c],"time"),m.senderId=tool.getXmlNodeAttr(d[c],"senderId"),s.push(m)}}n.list=s}"true"!=n.more&&(e.chatMore=!1),tool.isBlank(n.page)?e.chatPage=e.chatPage+1:e.chatPage=n.page-0+1,t.call(this,n)}})}},qaDeal:function(t){var e=this;if(this.qaMore){var a='<?xml version="1.0" encoding="utf-8"?><qaHistory siteid="'+vodInfo.siteId+'" userid="'+vodInfo.userId+'" confid="'+vodInfo.confId+'" live="false" page="'+this.qaPage+'"/>';tool.ajax({url:vodInfo.xmlApi,data:a,type:"POST",success:function(o){var o=tool.formatXml(o.data),n={};if(tool.isEmpty(o))logger.log("[qaDeal] xml isempty","info",a);else{var s=o.documentElement;n.more=tool.getXmlNodeAttr(s,"more");for(var r=s.getElementsByTagName("qa"),i=new Array,l=0;l<r.length;l++){var d={};d.id=tool.getXmlNodeAttr(r[l],"id"),d.question=tool.getXmlNodeAttr(r[l],"question"),d.submitor=tool.getXmlNodeAttr(r[l],"questionowner"),d.answer=tool.getXmlNodeAttr(r[l],"answer"),d.answerBy=tool.getXmlNodeAttr(r[l],"answerowner"),d.submitTime=tool.getXmlNodeAttr(r[l],"questiontimestamp"),d.answerTime=tool.getXmlNodeAttr(r[l],"qaanswertimestamp"),d.submitorId=tool.getXmlNodeAttr(r[l],"questionownerid"),d.answererId=tool.getXmlNodeAttr(r[l],"answerownerid"),i.push(d)}n.list=i}"true"!=n.more&&(e.chatMore=!1),tool.isBlank(n.page)?e.qaPage=e.qaPage+1:e.qaPage=n.page-0+1,t.call(this,n)}})}},msgDeal:function(t){var e='<?xml version="1.0" encoding="utf-8"?><leaveMsgHistory siteid="'+vodInfo.siteId+'" userid="'+vodInfo.userId+'" confid="'+vodInfo.confId+'" live="false"/>';tool.ajax({url:vodInfo.xmlApi,data:e,type:"POST",success:function(a){var a=tool.formatXml(a.data),o={};if(tool.isEmpty(a))logger.log("[msgDeal] xml isempty","info",e);else{for(var n=a.documentElement,s=new Array,r=n.getElementsByTagName("msg"),i=0;i<r.length;i++){var l={};l.id=tool.getXmlNodeAttr(r[i],"id"),l.question=tool.getXmlNodeAttr(r[i],"question"),l.submitTime=tool.getXmlNodeAttr(r[i],"questiontimestamp"),l.submitor=tool.getXmlNodeAttr(r[i],"questionowner"),l.answerTime=tool.getXmlNodeAttr(r[i],"qaanswertimestamp"),l.answerBy=tool.getXmlNodeAttr(r[i],"answerowner"),l.answer=tool.getXmlNodeAttr(r[i],"answer"),s.push(l)}o.list=s}t.call(this,o)}})}};pptRecord.recordDrawTime=function(t){if(!(t>=pptRecord.record_max_time)&&pptRecord.record_jsanno.length>1)for(var e=0;e<pptRecord.record_jsanno.length;e++)if(pptRecord.record_jsanno[e].starttimestamp<=t&&pptRecord.record_jsanno[e].stoptimestamp>t){if(pptRecord.record_jsanno_old[pptRecord.record_jsanno[e].jsanno])return;pptRecord.record_jsanno_old[pptRecord.record_jsanno[e].jsanno]=1,tool.ajax({type:"GET",url:mediaInfo.visitUrl+pptRecord.record_jsanno[e].jsanno,dataType:"json",success:function(t){dealAnnoData(t)},error:function(e){pptRecord.record_jsanno=[],pptRecord.recordGetMainAnno(t)}});break}},pptRecord.recordGetMainAnno=function(t){pptRecord.record_MainAnno&&(pptRecord.record_jsanno[0]={jsanno:pptRecord.record_MainAnno,starttimestamp:0,stoptimestamp:pptRecord.record_max_time,duration:pptRecord.record_max_time},t?pptRecord.record_jsanno_old[pptRecord.record_MainAnno]||tool.ajax({type:"GET",url:mediaInfo.visitUrl+ +pptRecord.record_MainAnno,dataType:"json",success:function(t){pptRecord.record_jsanno_old[pptRecord.record_MainAnno]=1,dealAnnoData(t)},error:function(t){}}):tool.ajax({type:"GET",url:mediaInfo.visitUrl+pptRecord.record_MainAnno,dataType:"json",success:function(t){pptRecord.record_jsanno_old[pptRecord.record_MainAnno]=1,pptRecord.is_pptRecord=1,dealAnnoData(t)},error:function(t){}}))},pptRecord.recordSeekTime=function(t){if(pptRecord.hasAnno&&pptRecord.pageRecordInfo.length>0){sendEvent("onAnno",{cmd:"clear"});for(var e=new Array,a=0;a<pptRecord.pageRecordInfo.length;a++)if(t>pptRecord.pageRecordInfo[a].starttimestamp&&t<pptRecord.pageRecordInfo[a].stoptimestamp){var o=pptRecord.pageRecordInfo[a];if(o.annodata.length>0)for(var n=0;n<o.annodata.length&&o.annodata[n].timestamp<=t;n++)for(var s=0;s<o.annodata[n].annoArray.length;s++)e.push(o.annodata[n].annoArray[s]);break}e.length>0&&sendEvent("onAnno",{cmd:"anno",annoArray:e})}},synChat.addAllSyn=function(){if(synChat.chatData.length>0)for(var t=0;t<synChat.chatData.length;t++){var e=synChat.chatData[t];addchatTask(e.data,e.starttime,e.stoptime)}synChat.chatData=[]},synChat.chatGetSyn=function(t){if(synChat.xmlChat=!0,t.conf.jschat&&null!=t.conf.jschat){var e=(new Date).getTimezoneOffset(),a=new Date(t.conf.starttime.replace(/\-/g,"/")).getTime();synChat.startTime=a-60*e*1e3,synChat.duration=1e3*parseFloat(t.conf.duration),synChat.chatMainFile=t.conf.jschat;for(var o={},n=0;n<t.conf.module.length;n++)if("multirecord"==t.conf.module[n].name){o=t.conf.module[n].multirecord;break}if(o&&tool.isArray(o)){for(var s=[],r=0,i=0;i<o.length;i++)o[i].chat&&null!=o[i].chat&&(s[o[i].chat]?synChat.chatList[r-1].stoptimestamp=1e3*parseFloat(o[i].stoptimestamp):(s[o[i].chat]=o[i].chat,synChat.chatList[r]={jschat:o[i].jschat,starttimestamp:1e3*parseFloat(o[i].starttimestamp),stoptimestamp:1e3*parseFloat(o[i].stoptimestamp),duration:1e3*parseFloat(o[i].duration)},r++));synChat.chatList.length>0?(synChat.requestedData[synChat.chatList[0].jschat]=1,tool.ajax({type:"GET",url:mediaInfo.visitUrl+synChat.chatList[0].jschat,dataType:"json",success:function(t){(t=t.data)&&t.module&&t.module.chat&&dealChatMsg(t.module.chat)},error:function(t){1==synChat.chatList.length&&synChat.chatGetMain()}})):synChat.chatGetMain()}else if(o&&o.jschat){var l=o.jschat;tool.ajax({type:"GET",url:mediaInfo.visitUrl+l,dataType:"json",success:function(t){(t=t.data)&&t.module&&t.module.chat&&dealChatMsg(t.module.chat)},error:function(t,e){synChat.chatGetMain()}})}else synChat.chatGetMain()}},synChat.chatGetMain=function(t){synChat.chatList=[],synChat.chatMainFile&&tool.ajax({type:"GET",url:mediaInfo.visitUrl+synChat.chatMainFile,dataType:"json",success:function(t){(t=t.data)&&t.module&&t.module.chat&&dealChatMsg(t.module.chat)},error:function(t){}})},synChat.chatCurrent=function(t){if(!(t>=synChat.duration)&&(t-synChat.playTime>3e3&&(synChat.lastTime=t,pptRecord.recordSeekTime(t),eventConfig.seeking=!1),synChat.playTime=t,synChat.chatList.length>1))for(var e=0;e<synChat.chatList.length;e++)t>=synChat.chatList[e].starttimestamp&&t<=synChat.chatList[e].stoptimestamp&&(synChat.requestedData[synChat.chatList[e].jschat]||(synChat.requestedData[synChat.chatList[e].jschat]=1,tool.ajax({type:"GET",url:mediaInfo.visitUrl+synChat.chatList[e].jschat,dataType:"json",success:function(t){(t=t.data)&&t.module&&t.module.chat&&dealChatMsg(t.module.chat)},error:function(t){}})))},synChat.chatslice=function(t,e){synChat.requestedData[synChat.chatList[t].jschat]=1,tool.ajax({type:"GET",url:mediaInfo.visitUrl+synChat.chatList[t].jschat,dataType:"json",success:function(t){t=t.data,t&&t.module&&t.module.chat&&dealChatMsg(t.module.chat),synChat.getMoreChat(e)},error:function(t){synChat.getMoreChat(e)}})},synChat.getMoreChat=function(t){var e={more:!1,list:[]},a=[],o=0;if(0!=synChat.lastTime)if(synChat.chatList.length<=1){synChat.sliceStartTime=0;for(var n=synChat.chathisData,s=0,r=n.length-1,i=0,l=r;l>=0&&s<100;l--)if(n[l].timestamp<synChat.lastTime&&n[l].timestamp>=synChat.sliceStartTime){if(a.push(n[l]),i=l,99==s&&l>0)for(var d=l-1;d>=0&&n[l].timestamp==n[d].timestamp;d--)a.push(n[d]);s++}0!=s&&0!=i&&100==s&&i<r&&(e.more=!0)}else{for(var l=0;l<synChat.chatList.length;l++)if(synChat.chatList[l].starttimestamp<synChat.lastTime&&synChat.chatList[l].stoptimestamp>=synChat.lastTime){if(l>=1)for(var d=l-1;d>=0;d--){if(!synChat.requestedData[synChat.chatList[d].jschat]){o=d;break}synChat.sliceStartTime=synChat.chatList[d].starttimestamp}break}for(var n=synChat.chathisData,s=0,r=n.length-1,i=0,l=r;l>=0&&s<100;l--)if(n[l].timestamp<synChat.lastTime&&n[l].timestamp>=synChat.sliceStartTime){if(a.push(n[l]),i=l,99==s&&l>0)for(var d=l-1;d>=0&&n[l].timestamp==n[d].timestamp;d--)a.push(n[d]);s++}if(0!=s&&0!=i&&100==s&&i<r)e.more=!0;else if(0==s&&0==i&&0!=o)return void synChat.chatslice(o,t)}if(a.sort(chatTimeSort),a.length>=1){synChat.lastTime=a[0].timestamp;for(var l=0;l<a.length;l++)e.list.push(a[l].data);t.call(this,e)}else t.call(this,e)},synChat.chatAllslice=function(t,e){synChat.requestedData[synChat.chatList[t].jschat]=1,tool.ajax({type:"GET",url:mediaInfo.visitUrl+synChat.chatList[t].jschat,dataType:"json",success:function(t){t=t.data,t&&t.module&&t.module.chat&&dealChatMsg(t.module.chat),synChat.getMoreAllChat(e)},error:function(t){synChat.getMoreAllChat(e)}})},synChat.getMoreAllChat=function(t){var e={more:!1,list:[]},a=[],o=0;if(synChat.lastTime<synChat.duration)if(synChat.chatList.length<=1){synChat.allSliceStartTime=0;for(var n=synChat.chathisData,s=0,r=n.length-1,i=0,l=0;l<=r&&s<100;l++)if(n[l].timestamp>synChat.allLastSeekTime){if(a.push(n[l]),i=l,99==s&&l<r)for(var d=l+1;d<=r&&n[l].timestamp==n[d].timestamp;d++)a.push(n[d]);s++}0!=s&&0!=i&&100==s&&i<r&&(e.more=!0)}else{synChat.sliceEndTime=synChat.chatList[0].stoptimestamp;for(var l=0;l<synChat.chatList.length;l++)if(synChat.chatList[l].starttimestamp<synChat.allLastSeekTime&&synChat.chatList[l].stoptimestamp>=synChat.allLastSeekTime){synChat.sliceEndTime=synChat.chatList[l].stoptimestamp;for(var d=l+1;d<synChat.chatList.length;d++){if(!synChat.requestedData[synChat.chatList[d].jschat]){o=d;break}synChat.sliceEndTime=synChat.chatList[d].stoptimestamp}break}for(var n=synChat.chathisData,s=0,r=n.length-1,i=0,l=0;l<=r&&s<100;l++)if(n[l].timestamp>synChat.allLastSeekTime&&n[l].timestamp<=synChat.sliceEndTime){if(a.push(n[l]),i=l,99==s&&l<r)for(var d=l+1;d<=r&&n[l].timestamp==n[d].timestamp;d++)a.push(n[d]);s++}if(0!=s&&0!=i&&100==s&&i<r)e.more=!0;else if(0==s&&0==i&&0!=o)return void synChat.chatAllslice(o,t)}if(a.sort(chatTimeSort),a.length>=1){synChat.allLastSeekTime=a[a.length-1].timestamp;for(var l=0;l<a.length;l++)e.list.push(a[l].data);t.call(this,e)}else t.call(this,e)};var submitDealFuns={seek:function(t){},pause:function(t){},play:function(t){},playheadTime:function(t){var e=app.globalData.currentTime;sendEvent("onPlayheadTime",{playheadTime:1e3*e})},submitVote:function(t){var e=t.data,a=checkVote(e);if(a.result)sendVoteSurvey(e);else{var o={};o.api="submitVote",o.param=e,o.explain=a.explain,o.type=a.type,sendEvent("onAPIError",o)}},uploadLogFile:function(t){logMangement.uploadLogFile(playInfo.videoInfo.ownerid,playInfo.videoInfo.site,playInfo.videoInfo.ctx,playInfo.userInfo.siteid,playInfo.userInfo.userid,playInfo.userInfo.username,playInfo.logFileInfo,t)},leaveMessage:function(t){var e=t.data;if(tool.isEmpty(e)||tool.isBlank(e.content)){var a={};a.api="leaveMessage",a.param=e,a.explain="The data format is error or is null.",a.type=1,sendEvent("onAPIError",a)}else{var o='<?xml version="1.0" encoding="UTF-8"?>'
;o=o+"<qaSubmit><siteId>"+vodInfo.siteId+"</siteId>",o=o+"<confId>"+vodInfo.confId+"</confId>",o=o+"<userId>"+vodInfo.userId+"</userId>",o+="<isLive>false</isLive>",o=o+"<userName><![CDATA["+vodInfo.userName+"]]></userName>",o=o+"<question><![CDATA["+e.content+"]]></question><filter>false</filter>",o=o+"<email><![CDATA["+e.email+"]]></email></qaSubmit>",tool.ajax({type:"post",url:vodInfo.xmlApi,data:o})}},submitMute:function(t){},submitVolume:function(t){},submitStop:function(t){},submitQAList:function(t){chatAndMsg.qaDeal(function(t){sendEvent("onQAList",t)})},submitChatHistory:function(t){synChat.xmlChat?synChat.getMoreAllChat(function(t){sendEvent("onChatHistory",t)}):chatAndMsg.chatDeal(function(t){sendEvent("onChatHistory",t)})},submitChatSegment:function(t){synChat.xmlChat&&synChat.chatSync&&synChat.getMoreChat(function(t){sendEvent("onChatSegmentList",t)})},submitLeaveMessageList:function(t){chatAndMsg.msgDeal(function(t){sendEvent("onLeaveMessageList",t)})},setupChatSync:function(t){var e=t.data;synChat.xmlChat&&e.open?(synChat.chatSync=!0,synChat.addAllSyn()):synChat.chatSync=!1}},submitCommand=function(t){return submitDealFuns[t]},onBindEventHandler=function(t){var e=submitCommand(t.type);void 0!=e&&"function"==typeof e?e.call(this,t):sendEvent("onAPIError",{api:t.type,expalin:"The api name is error"})},sendEvent=function(t,e){setTimeout(function(){channel.send(t,e)},0)},destroy=function(){},reset=function(){};GS_MEDIA._open_={init:function(t){var e={};channel=app.globalData.channel,wgid=channel.id,tool.checkObjectIsNull(t.site)&&(e.api="init",e.param=t.site,e.explain="Parameter site miss",e.type=2),tool.checkObjectIsNull(t.ownerid)&&(e.api="init",e.param=t.ownerid,e.explain="Parameter ownerid miss",e.type=2),tool.checkObjectIsNull(t.uid)&&(t.uid=""),tool.checkObjectIsNull(t.uname)&&(t.uname=""),tool.checkObjectIsNull(t.encodetype)&&(t.encodetype=""),tool.checkObjectIsNull(t.password)&&(t.password=""),tool.checkObjectIsNull(t.ownerid)&&(t.ownerid=""),tool.checkObjectIsNull(t.ctx)&&(t.ctx="webcast"),tool.checkObjectIsNull(t.authcode)&&(t.authcode=""),tool.checkObjectIsNull(t.k)&&(t.k=""),tool.checkObjectIsNull(t.istest)&&(t.istest=!1);var a;a=t.istest?"http://":"https://","training"===t.ctx?(a+=t.site+"/sdk/site/sdk/tra/vod/wxconfig",scType=1):(a+=t.site+"/sdk/site/sdk/vod/wxconfig",scType=""),a+="?ownerid="+t.ownerid+"&authcode="+t.authcode+"&uid="+t.uid+"&uname="+t.uname+"&encodetype="+t.encodetype+"&password="+t.password+"&k="+t.k+"&istest="+t.istest+"&scType="+scType,logger.log("init url:"+a),wx.request({url:a,header:{"content-type":"application/json","cache-control":"no-cache"},success:function(a){var o=a.data;playInfo.videoInfo=t,playInfo.userInfo={userid:o.uid,username:o.userName,siteid:o.siteId},o.clientApi?playInfo.logFileInfo.clientApi=o.clientApi:playInfo.logFileInfo.clientApi="",o.diagnoseUploadUrl?playInfo.logFileInfo.diagnoseUploadUrl=o.diagnoseUploadUrl:playInfo.logFileInfo.diagnoseUploadUrl="","success"==o.type?(o.sslSupport&&!t.istest?(xmlUrl=o.xmlUrl.replace("http://","https://"),xmlUrl=xmlUrl.replace("https://","https://"+o.wxxApi),protocolPrex="https://"):(xmlUrl=o.xmlUrl,protocolPrex="http://"),o.vodKickOut&&(onlyLogin="1"),tool.checkObjectIsNull(o.connectSvr)||(alb=o.connectSvr),tool.checkObjectIsNull(o.bakConnectSvr)||(backAlb=o.bakConnectSvr),vodInfo.xmlApi=o.siteUrl+o.xmlapiContextPath+"/apichannel",""!=o.scType&&void 0!=o.scType&&(vodInfo.xmlApi+="?sc="+o.scType),vodInfo.containerId=wgid,vodInfo.xmlUrl=xmlUrl,vodInfo.protocolPrex=protocolPrex,vodInfo.sslSupport=o.sslSupport,vodInfo.siteId=o.siteId,vodInfo.userId=o.uid,vodInfo.userName=o.userName,vodInfo.confId=t.ownerid,vodInfo.hostId=o.hostId,vodInfo.tid=o.tkId,vodInfo.onlyLogin=onlyLogin,vodInfo.alb=alb,vodInfo.backAlb=backAlb,vodInfo.albProxy=scType,vodInfo.sc=scType,wxxApi=t.istest?"":o.wxxApi,channel.send("onTitle",{content:o.subject}),initEvent(),getXmlData()):(e.api="init",e.param=o,e.explain="Vod Background check is not passed:"+JSON.stringify(o)+"-----type:"+o.type+"-----desc:"+o.desc,e.type=1,tool.checkObjectIsNull(e)||channel.send("onAPIError",e))},fail:function(a){e.api="init",e.param="site:"+t.site,e.explain="vod fail:"+a.errMsg,e.type=1,tool.checkObjectIsNull(e)||channel.send("onAPIError",e)}})},refresh:function(){wgid&&GS.clearChannel(),tasks.stop&&(tasks.clear(),tasks.stop()),recordInfo={hls:"",highHls:"",hlsAudioOnly:"",duration:"",liveTextFile:"",jsContent:"",playing:!1,voteSurveyList:new Array,lotteryArray:new Array,layoutArray:new Array,docArray:new Array},eventConfig={firstPlay:!0,firstCanPlay:!0,canPlay:!1,seeking:!1},vodInfo={containerId:"",xmlUrl:"",protocolPrex:"http://",sslSupport:!1,siteId:0,userId:0,userName:"",confId:"",hostId:0,tid:"",sc:"sc=0",onlyLogin:"0",alb:"",backAlb:"",xmlApi:"",albProxy:"",video:!0},clearInterval(serverParam.keepTimeId),serverParam={sessionId:"",currentAlb:"",startTime:0,lastTime:0,watchMaxDuration:0,keepTimeId:0,keepInterval:1e4},synChat.startTime="",synChat.duration="",synChat.chatMainFile="",synChat.chatList=[],synChat.requestedData={},synChat.lastTime=0,synChat.chathisData=[],synChat.chatData=[],synChat.currentTime=0,synChat.xmlChat=!1,synChat.sliceStartTime=0,synChat.sliceEndTime=0,synChat.chatSync=!1,synChat.allHisFirst=!0,synChat.allLastSeekTime=0,synChat.playTime=0,pptRecord.is_pptRecord=0,pptRecord.record_max_time=0,pptRecord.record_jsanno=[],pptRecord.record_jsanno_old={},pptRecord.record_MainAnno="",pptRecord.hasAnno=!1,pptRecord.pageRecordInfo=[],chatAndMsg.chatMore=!0,chatAndMsg.qaMore=!0,chatAndMsg.chatPage=1,chatAndMsg.qaPage=1,scType=""}},GS_MEDIA.initMediaEvent={play:function(){eventConfig.firstPlay?(tasks.start(),eventConfig.firstPlay=!1,sendEvent("loadStart",{})):sendEvent("onPlay",{timestamp:1e3*app.globalData.currentTime})},pause:function(){sendEvent("onPause",{timestamp:1e3*app.globalData.currentTime})},ended:function(){sendEvent("onStop",{})},playing:function(){eventConfig.firstCanPlay&&(eventConfig.firstCanPlay=!1,sendEvent("onStatus",{type:9,explain:"media can play"}))},seeked:function(){if(eventConfig.seeking){eventConfig.seeking=!1;var t=1e3*parseFloat(app.globalData.currentTime);sendEvent("onSeekCompleted",{timestamp:t}),synChat.lastTime=t,synChat.playTime=t,pptRecord.recordSeekTime(t)}},seeking:function(){eventConfig.seeking=!0},timeupdate:function(){var t=app.globalData.currentTime,e=1e3*parseFloat(t);pptRecord.recordDrawTime(e),synChat.chatCurrent(e)},timeRecord:function(){var t=app.globalData.currentTime;t>serverParam.lastTime&&(serverParam.watchMaxDuration+=t-serverParam.lastTime),serverParam.lastTime=t}},module.exports=GS_MEDIA;
